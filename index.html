<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì‚¬ë‚´ ë””ì§€í„¸ ì‚¬ì´ë‹ˆì§€ (New Year Edition)</title>
    <style>
        /* ================= ê¸°ë³¸ ìŠ¤íƒ€ì¼ ================= */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; font-family: 'Pretendard', 'Malgun Gothic', sans-serif; background-color: #000; color: #fff; }
        #signage-container { width: 100%; height: 100%; position: relative; overflow: hidden; }
        .page { width: 100%; height: 100%; box-sizing: border-box; position: relative; z-index: 10; }

        /* ================= ëˆˆ ë‚´ë¦¬ëŠ” íš¨ê³¼ ================= */
        #snow-container {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999;
            overflow: hidden; display: none;
        }
        .snowflake {
            position: absolute; top: -10px; background: white; border-radius: 50%; opacity: 0.8;
            animation: fall linear infinite;
        }
        @keyframes fall {
            to { transform: translateY(110vh); }
        }

        /* ================= í˜ì´ì§€ ìŠ¤íƒ€ì¼ ================= */
        .celebration-page {
            display: flex; flex-direction: column; justify-content: flex-end; align-items: center; text-align: center;
            background-size: cover; background-position: center;
            animation: zoomEffect 20s linear infinite alternate;
        }
        @keyframes zoomEffect {
            from { transform: scale(1); }
            to { transform: scale(1.1); }
        }
        .celebration-page .msg-container {
            margin-bottom: 100px;
            text-shadow: 0 4px 30px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.3);
            padding: 20px 40px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 215, 0, 0.3);
            animation: fadeUp 2s ease-out;
        }
        .celebration-page h2 {
            font-size: 2rem; color: #FFD700; font-weight: 300; letter-spacing: 5px; margin: 0;
            font-family: 'Times New Roman', serif;
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .info-page { background-size: cover; background-position: center; display: flex; flex-direction: column; justify-content: space-between; padding: 40px; transition: background-image 1.5s ease-in-out; }
        .info-page .time-date-section { position: absolute; top: 40px; left: 40px; background-color: rgba(0,0,0,0.5); padding: 20px 25px; border-radius: 10px; text-shadow: 2px 2px 4px rgba(0,0,0,0.7); }
        .info-page .time-display { font-size: 5rem; font-weight: bold; }
        .info-page .date-display, .info-page .day-display { font-size: 2rem; text-align: right; }
        .info-page .dday-section { position: absolute; bottom: 40px; left: 40px; right: 40px; display: flex; justify-content: space-between; align-items: flex-end; }
        .info-page .dday-item { background-color: rgba(0,0,0,0.5); padding: 20px; border-radius: 10px; min-width: 300px; }
        .info-page .dday-item:first-child { text-align: left; }
        .info-page .dday-item:last-child { text-align: right; }
        .info-page .dday-item h2 { font-size: 1.5rem; margin: 0 0 10px 0; font-weight: normal; }
        .info-page .dday-item .dday-value { font-size: 4rem; font-weight: bold; color: #FFD700; }
        .info-page .dday-item .target-date { font-size: 1rem; margin-top: 5px; }

        .info-page-alt { background-size: cover; background-position: center; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; background-blend-mode: multiply; background-color: rgba(0,0,0,0.5); }
        .info-page-alt .time-display { font-size: 8rem; font-weight: bold; text-shadow: 3px 3px 6px #000; }
        .info-page-alt .date-display { font-size: 2.5rem; margin-top: -10px; text-shadow: 2px 2px 4px #000; }
        .info-page-alt .dday-section { display: flex; gap: 40px; margin-top: 40px; }
        .info-page-alt .dday-item { background: none; padding: 0; }
        .info-page-alt .dday-item h2 { font-size: 1.8rem; }
        .info-page-alt .dday-item .dday-value { font-size: 5rem; }
        
        .image-page { display: flex; justify-content: center; align-items: center; background-color: #000; }
        .image-page img { width: 100%; height: 100%; object-fit: contain; }
        .youtube-page iframe, .web-page iframe { width: 100%; height: 100%; border: none; }
        
        .weather-page { display: flex; flex-direction: column; background: linear-gradient(to bottom, #3a7bd5, #3a6073); padding: 50px; }
        .weather-page .current-weather { display: flex; justify-content: center; align-items: center; text-align: left; flex-grow: 1; }
        .weather-page .current-weather .icon { font-size: 10rem; margin-right: 40px; }
        .weather-page .current-weather .details .location { font-size: 2rem; font-weight: bold; }
        .weather-page .current-weather .details .temp { font-size: 7rem; font-weight: bold; }
        .weather-page .current-weather .details .desc { font-size: 2rem; margin-top: -15px; }
        .weather-page .current-weather .details .minmax { font-size: 1.5rem; margin-top: 10px; }
        .weather-page .forecast { display: flex; justify-content: space-around; border-top: 2px solid rgba(255,255,255,0.5); padding-top: 30px; }
        .weather-page .forecast .hour { text-align: center; }
        .weather-page .forecast .hour .time { font-size: 1.5rem; }
        .weather-page .forecast .hour .icon { font-size: 3.5rem; margin: 10px 0; }
        .weather-page .forecast .hour .temp { font-size: 1.8rem; font-weight: bold; }

        /* ================= ê´€ë¦¬ì ì„¤ì • ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ================= */
        #settings-btn {
            position: fixed; bottom: 20px; right: 20px; z-index: 20000;
            background: rgba(255, 255, 255, 0.2); color: white;
            border: none; border-radius: 50%; width: 50px; height: 50px;
            font-size: 24px; cursor: pointer; opacity: 0.3; transition: opacity 0.3s;
        }
        #settings-btn:hover { opacity: 1; background: rgba(255, 255, 255, 0.6); }

        #config-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.85); z-index: 20001;
            justify-content: center; align-items: center;
        }
        .modal-content {
            background: #1e1e1e; padding: 25px; border-radius: 12px; width: 90%; max-width: 900px; height: 85vh;
            color: #fff; display: flex; flex-direction: column;
            border: 1px solid #333; box-shadow: 0 0 30px rgba(0,0,0,0.7);
        }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .modal-header h2 { margin: 0; font-size: 1.5rem; color: #FFD700; }
        .modal-body { flex: 1; overflow-y: auto; padding-right: 10px; }

        /* ì—ë””í„° ì¹´ë“œ ìŠ¤íƒ€ì¼ */
        .editor-card {
            background: #2a2a2a; border-radius: 8px; padding: 15px; margin-bottom: 15px;
            border: 1px solid #333; display: flex; gap: 15px; align-items: flex-start;
        }
        .editor-card:hover { border-color: #555; }
        .card-order {
            display: flex; flex-direction: column; gap: 5px; justify-content: center; align-items: center; width: 40px;
        }
        .card-content { flex: 1; display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; }
        
        .form-group { display: flex; flex-direction: column; gap: 5px; }
        .form-group label { font-size: 0.8rem; color: #aaa; }
        .form-group input, .form-group textarea, .form-group select {
            background: #333; border: 1px solid #444; color: #fff; padding: 8px; border-radius: 4px;
            font-size: 0.9rem;
        }
        .form-group input:focus { border-color: #FFD700; outline: none; }
        
        .btn-mini { padding: 4px 8px; font-size: 0.8rem; cursor: pointer; background: #444; color: #fff; border: none; border-radius: 4px; }
        .btn-mini:hover { background: #666; }
        .btn-delete { background: #5a2e2e; }
        .btn-delete:hover { background: #d32f2f; }

        .btn-group { display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; border-top: 1px solid #333; padding-top: 15px; }
        .btn { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; font-size: 1rem;}
        .btn-save { background: #28a745; color: white; }
        .btn-close { background: #666; color: white; }
        .btn-reset { background: #dc3545; color: white; margin-right: auto; }
        .btn-add { background: #007bff; color: white; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }

        .modal-body::-webkit-scrollbar { width: 8px; }
        .modal-body::-webkit-scrollbar-track { background: #1e1e1e; }
        .modal-body::-webkit-scrollbar-thumb { background: #444; border-radius: 4px; }

        /* ì»¤ìŠ¤í…€ í† ìŠ¤íŠ¸ & í™•ì¸ì°½ */
        #toast-message {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%);
            background: rgba(40, 167, 69, 0.9); color: white; padding: 12px 24px; border-radius: 25px;
            font-size: 1rem; box-shadow: 0 4px 15px rgba(0,0,0,0.3); z-index: 20002;
            opacity: 0; transition: opacity 0.5s; pointer-events: none;
        }
        #confirm-dialog {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 20005;
            justify-content: center; align-items: center;
        }
        .confirm-box {
            background: #2a2a2a; padding: 25px; border-radius: 10px; text-align: center;
            border: 1px solid #444; box-shadow: 0 10px 30px rgba(0,0,0,0.5); min-width: 300px;
        }
        .confirm-box h3 { margin-top: 0; color: #FFD700; }
        .confirm-actions { margin-top: 20px; display: flex; justify-content: center; gap: 10px; }
    </style>
</head>
<body>
    <div id="snow-container"></div>

    <div id="signage-container">
        <div id="loading-screen" class="page" style="display:flex; justify-content:center; align-items:center; font-size:2rem;">
            ì‚¬ì´ë‹ˆì§€ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤... (New Year Edition)
        </div>
    </div>

    <!-- ì»¤ìŠ¤í…€ UI ìš”ì†Œ -->
    <button id="settings-btn" onclick="openConfig()" title="ê´€ë¦¬ì ì„¤ì •">âš™ï¸</button>
    <div id="toast-message">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!</div>
    
    <!-- ì‚­ì œ í™•ì¸ ë‹¤ì´ì–¼ë¡œê·¸ -->
    <div id="confirm-dialog">
        <div class="confirm-box">
            <h3>ì‚­ì œ í™•ì¸</h3>
            <p>ì •ë§ ì´ í™”ë©´ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?</p>
            <div class="confirm-actions">
                <button class="btn btn-close" onclick="closeConfirm()">ì·¨ì†Œ</button>
                <button class="btn btn-delete" onclick="executeDelete()">ì‚­ì œ</button>
            </div>
        </div>
    </div>

    <!-- ì„¤ì • ëª¨ë‹¬ -->
    <div id="config-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ ì¬ìƒëª©ë¡ í¸ì§‘</h2>
                <button class="btn btn-add" onclick="showAddMenu()">+ í™”ë©´ ì¶”ê°€</button>
            </div>
            <div class="modal-body" id="playlist-editor-container"></div>
            <div class="btn-group">
                <button class="btn btn-reset" onclick="resetPlaylist()">ì´ˆê¸°í™”</button>
                <button class="btn btn-save" onclick="savePlaylist()">ì €ì¥ ë° ì ìš©</button>
                <button class="btn btn-close" onclick="closeConfig()">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <script>
    // ====================================================================================
    // --- (â˜…ë§¤ìš° ì¤‘ìš”) ì‚¬ì´ë‹ˆì§€ ë‚´ìš©ì€ ì—¬ê¸°ì—ì„œë§Œ ìˆ˜ì •í•˜ì„¸ìš”! ---
    // ====================================================================================
    const PLAYLIST = [

        // 2. ì •ë³´ í™”ë©´ (ì¢Œì¸¡ ì •ë ¬) - D-Day: 2026 New Year
        {
            type: 'info_page',
            duration: 15,
            backgroundImages: [
                'https://images.unsplash.com/photo-1543589077-47d81606c1bf?q=80&w=2574&auto=format&fit=crop',
                'https://images.unsplash.com/photo-1576919228236-a097c32a5cd4?q=80&w=2670&auto=format&fit=crop'
            ],
            ddayTargets: [
                { title: '2026 New Year', date: '2026-01-01' }
            ],
            snowEffect: true
        },
        
        // 9. ìŠ¤ë…¸ìš°ë³¼
        {
            type: 'image_page',
            duration: 7,
            imageUrl: 'images/ìŠ¤ë…¸ìš°ë³¼2.png',
            snowEffect: false
        },
        
        // // 3. ì‹ë‹¨í‘œ ì´ë¯¸ì§€
        // {
        //     type: 'image_page',
        //     duration: 10,
        //     imageUrl: 'images/ì‹ë‹¨í‘œ.png',
        //     snowEffect: false
        // },

        // 4. ì •ë³´ í™”ë©´ (ì¤‘ì•™ ì •ë ¬)
        {
            type: 'info_page_alt',
            duration: 15,
            backgroundImage: 'https://images.pexels.com/photos/933054/pexels-photo-933054.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1',
            ddayTargets: [
                { title: '2026 New Year', date: '2026-01-01' }
            ],
            snowEffect: true
        },

        // 5. íŠ¸ë¦¬ ìœ íŠœë¸Œ
        {
            type: 'youtube_page',
            duration: 17,
            videoId: 'l2wVgMDS8Yg',
            snowEffect: false
        },

        // // 6. HBH ì´ë¯¸ì§€
        // {
        //     type: 'image_page',
        //     duration: 10,
        //     imageUrl: 'images/1.png',
        //     snowEffect: false
        // },

        // // 7. HBH1 ì´ë¯¸ì§€
        // {
        //     type: 'image_page',
        //     duration: 10,
        //     imageUrl: 'images/HBH1.png',
        //     snowEffect: false
        // },

        // 8. ì°ë§¤
        {
            type: 'youtube_page',
            duration: 16,
            videoId: '19Mm6yRGidc',
            snowEffect: false
        },

        // 9. íŠ¸ë¦¬2
        {
            type: 'image_page',
            duration: 7,
            imageUrl: 'images/tree2.png',
            snowEffect: false
        },

        // 10. ë‚ ì”¨ ì •ë³´
        {
            type: 'weather_page',
            duration: 20,
            snowEffect: false
        },


        // 9. íŠ¸ë¦¬1
        {
            type: 'image_page',
            duration: 7,
            imageUrl: 'images/íŠ¸ë¦¬1.png',
            snowEffect: false
        },
        
    ];

    // --- (ìˆ˜ì • ê°€ëŠ¥í•œ ì˜ˆë¹„ ì•„ì´í…œë“¤) í•„ìš”í•˜ë©´ ìœ„ PLAYLISTì— ë³µì‚¬í•´ì„œ ë„£ìœ¼ì„¸ìš” ---
    //
    // // ë³´ì•ˆ ì´ë¯¸ì§€ 1
    // {
    //     type: 'image_page',
    //     duration: 10,
    //     imageUrl: 'images/ë³´ì•ˆ1.png',
    //     snowEffect: false
    // },
    //
    // // íšŒì˜ì‹¤ ì´ë¯¸ì§€
    // {
    //     type: 'image_page',
    //     duration: 15,
    //     imageUrl: 'images/íšŒì˜ì‹¤1.png',
    //     snowEffect: false
    // },
    //
    // // ë§¤ë„ˆ ìº í˜ì¸
    // {
    //     type: 'image_page',
    //     duration: 15,
    //     imageUrl: 'images/ë§¤ë„ˆ1.png',
    //     snowEffect: false
    // },

    let currentPlaylist = [];
    let deleteTargetIndex = -1;

    // ====================================================================================
    // --- ê´€ë¦¬ì ê¸°ëŠ¥ ë¡œì§ ---
    // ====================================================================================

    function loadPlaylistData() {
        const saved = localStorage.getItem('signage_playlist');
        if (saved) {
            try { currentPlaylist = JSON.parse(saved); } 
            catch (e) { currentPlaylist = JSON.parse(JSON.stringify(PLAYLIST)); }
        } else {
            currentPlaylist = JSON.parse(JSON.stringify(PLAYLIST));
        }
    }

    function openConfig() {
        document.getElementById('config-modal').style.display = 'flex';
        renderEditor();
    }
    function closeConfig() {
        document.getElementById('config-modal').style.display = 'none';
    }

    function showToast(msg, isError = false) {
        const toast = document.getElementById('toast-message');
        toast.textContent = msg;
        toast.style.background = isError ? 'rgba(220, 53, 69, 0.9)' : 'rgba(40, 167, 69, 0.9)';
        toast.style.opacity = '1';
        setTimeout(() => { toast.style.opacity = '0'; }, 3000);
    }

    function deleteItem(index) {
        deleteTargetIndex = index;
        document.getElementById('confirm-dialog').style.display = 'flex';
    }
    function closeConfirm() {
        document.getElementById('confirm-dialog').style.display = 'none';
        deleteTargetIndex = -1;
    }
    function executeDelete() {
        if (deleteTargetIndex > -1) {
            currentPlaylist.splice(deleteTargetIndex, 1);
            renderEditor();
            closeConfirm();
        }
    }

    function escapeHtml(text) {
        if (!text) return '';
        return String(text).replace(/"/g, '&quot;');
    }

    function renderEditor() {
        const container = document.getElementById('playlist-editor-container');
        container.innerHTML = '';

        currentPlaylist.forEach((item, index) => {
            const card = document.createElement('div');
            card.className = 'editor-card';

            const controls = `
                <div class="card-order">
                    <button class="btn-mini" onclick="moveItem(${index}, -1)" ${index===0?'disabled':''}>â–²</button>
                    <span style="font-weight:bold; color:#FFD700">${index + 1}</span>
                    <button class="btn-mini" onclick="moveItem(${index}, 1)" ${index===currentPlaylist.length-1?'disabled':''}>â–¼</button>
                    <button class="btn-mini btn-delete" onclick="deleteItem(${index})">ğŸ—‘ï¸</button>
                </div>
            `;

            let contentFields = `
                <div class="form-group">
                    <label>í™”ë©´ ìœ í˜•</label>
                    <input type="text" value="${translateType(item.type)}" disabled style="color:#aaa;">
                </div>
                <div class="form-group">
                    <label>ì¬ìƒ ì‹œê°„ (ì´ˆ)</label>
                    <input type="number" value="${item.duration}" onchange="updateItem(${index}, 'duration', this.value)">
                </div>
            `;

            if (item.type === 'celebration_page') {
                contentFields += `
                    <div class="form-group"><label>ì´ë¯¸ì§€ URL</label><input type="text" value="${escapeHtml(item.imageUrl)}" onchange="updateItem(${index}, 'imageUrl', this.value)"></div>
                    <div class="form-group"><label>ì¶•í•˜ ë¬¸êµ¬</label><input type="text" value="${escapeHtml(item.subText)}" onchange="updateItem(${index}, 'subText', this.value)"></div>
                `;
            } else if (item.type === 'image_page') {
                contentFields += `
                    <div class="form-group"><label>ì´ë¯¸ì§€ URL</label><input type="text" value="${escapeHtml(item.imageUrl)}" onchange="updateItem(${index}, 'imageUrl', this.value)"></div>
                `;
            } else if (item.type === 'youtube_page') {
                contentFields += `
                    <div class="form-group"><label>ìœ íŠœë¸Œ ì˜ìƒ ID</label><input type="text" value="${escapeHtml(item.videoId)}" onchange="updateItem(${index}, 'videoId', this.value)"></div>
                `;
            } else if (item.type === 'info_page' || item.type === 'info_page_alt') {
                const bgStr = Array.isArray(item.backgroundImages) ? item.backgroundImages.join(',') : (item.backgroundImage || '');
                contentFields += `
                    <div class="form-group"><label>ë°°ê²½ ì´ë¯¸ì§€ URL (ì½¤ë§ˆë¡œ êµ¬ë¶„)</label><input type="text" value="${escapeHtml(bgStr)}" onchange="updateBgImages(${index}, '${item.type}', this.value)"></div>
                `;
                if (item.ddayTargets && item.ddayTargets.length > 0) {
                    contentFields += `
                        <div class="form-group"><label>D-Day ì œëª©</label><input type="text" value="${escapeHtml(item.ddayTargets[0].title)}" onchange="updateDday(${index}, 'title', this.value)"></div>
                        <div class="form-group"><label>D-Day ë‚ ì§œ (YYYY-MM-DD)</label><input type="text" value="${escapeHtml(item.ddayTargets[0].date)}" onchange="updateDday(${index}, 'date', this.value)"></div>
                    `;
                }
            }
            
            contentFields += `
                 <div class="form-group">
                    <label>ëˆˆ ë‚´ë¦¼ íš¨ê³¼</label>
                    <select onchange="updateItem(${index}, 'snowEffect', this.value === 'true')">
                        <option value="true" ${item.snowEffect ? 'selected' : ''}>ì¼œê¸°</option>
                        <option value="false" ${!item.snowEffect ? 'selected' : ''}>ë„ê¸°</option>
                    </select>
                </div>
            `;

            card.innerHTML = controls + `<div class="card-content">${contentFields}</div>`;
            container.appendChild(card);
        });
    }

    function translateType(type) {
        const map = { 'celebration_page': 'ğŸ‰ ì¶•í•˜/ê³µì§€', 'info_page': 'â„¹ï¸ ì •ë³´(ì¢Œ)', 'info_page_alt': 'â„¹ï¸ ì •ë³´(ì¤‘ì•™)', 'image_page': 'ğŸ–¼ï¸ ì´ë¯¸ì§€', 'youtube_page': 'ğŸ“º ìœ íŠœë¸Œ', 'weather_page': 'â›… ë‚ ì”¨' };
        return map[type] || type;
    }

    function updateItem(index, key, value) {
        if (key === 'duration') value = Number(value);
        currentPlaylist[index][key] = value;
    }

    function updateBgImages(index, type, val) {
        if (type === 'info_page') {
            currentPlaylist[index].backgroundImages = val.split(',').map(s => s.trim()).filter(s => s);
        } else {
            currentPlaylist[index].backgroundImage = val.trim();
        }
    }

    function updateDday(index, key, val) {
        if (!currentPlaylist[index].ddayTargets) currentPlaylist[index].ddayTargets = [{}];
        currentPlaylist[index].ddayTargets[0][key] = val;
    }

    function moveItem(index, direction) {
        const temp = currentPlaylist[index];
        currentPlaylist[index] = currentPlaylist[index + direction];
        currentPlaylist[index + direction] = temp;
        renderEditor();
    }

    function showAddMenu() {
        const type = prompt("ì¶”ê°€í•  ë²ˆí˜¸ ì…ë ¥:\n1. ì´ë¯¸ì§€\n2. ìœ íŠœë¸Œ\n3. ê³µì§€ì‚¬í•­");
        let newItem = null;
        if (type === '1') newItem = { type: 'image_page', duration: 10, imageUrl: 'https://placehold.co/1920x1080/333/fff?text=New+Image', snowEffect: false };
        else if (type === '2') newItem = { type: 'youtube_page', duration: 20, videoId: 'VIDEO_ID', snowEffect: false };
        else if (type === '3') newItem = { type: 'celebration_page', duration: 15, imageUrl: '', subText: 'ìƒˆ ê³µì§€ì‚¬í•­', snowEffect: true };
        
        if (newItem) {
            currentPlaylist.push(newItem);
            renderEditor();
            setTimeout(() => {
                const body = document.getElementById('playlist-editor-container');
                body.scrollTop = body.scrollHeight;
            }, 100);
        }
    }

    // [í•µì‹¬ ìˆ˜ì •] ì €ì¥ ì‹œ ìƒˆë¡œê³ ì¹¨ ì—†ì´ ì¦‰ì‹œ ì ìš©
    function savePlaylist() {
        try {
            localStorage.setItem('signage_playlist', JSON.stringify(currentPlaylist));
            showToast("ì €ì¥ ë° ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤!");
        } catch (e) {
            showToast("ì„¤ì •ì´ ë©”ëª¨ë¦¬ì—ë§Œ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. (ë¸Œë¼ìš°ì € ì œí•œ)", true);
            console.error(e);
        }
        
        // ìƒˆë¡œê³ ì¹¨ ëŒ€ì‹  ì¦‰ì‹œ ì¬ì‹œì‘
        closeConfig();
        restartSignage();
    }

    function resetPlaylist() {
        // ì»¤ìŠ¤í…€ ë‹¤ì´ì–¼ë¡œê·¸ ëŒ€ì‹  ê°„ë‹¨íˆ ì²˜ë¦¬ (í•„ìš”ì‹œ êµì²´)
        if (confirm('ì •ë§ ì´ˆê¸°í™” í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
            localStorage.removeItem('signage_playlist');
            currentPlaylist = JSON.parse(JSON.stringify(PLAYLIST));
            showToast("ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
            closeConfig();
            restartSignage();
        }
    }

    // [New] ì‚¬ì´ë‹ˆì§€ ì¬ì‹œì‘ í—¬í¼ í•¨ìˆ˜
    function restartSignage() {
        // ê¸°ì¡´ íƒ€ì´ë¨¸ ì œê±°
        if(clockInterval) clearInterval(clockInterval);
        if(pageTimeout) clearTimeout(pageTimeout);
        
        // ì¸ë±ìŠ¤ ì´ˆê¸°í™” ë° ì¦‰ì‹œ ë Œë”ë§
        currentPageIndex = 0;
        showNextPage();
    }

    // ====================================================================================
    // --- ì—”ì§„ ë¡œì§ ---
    // ====================================================================================

    const signageContainer = document.getElementById('signage-container');
    const snowContainer = document.getElementById('snow-container');
    let currentPageIndex = 0;
    let clockInterval, pageTimeout;
    let infoPageDisplayCount = 0;

    function createSnowflakes() {
        snowContainer.innerHTML = '';
        const snowflakeCount = 50; 
        for (let i = 0; i < snowflakeCount; i++) {
            const snowflake = document.createElement('div');
            snowflake.classList.add('snowflake');
            snowflake.style.left = Math.random() * 100 + 'vw';
            snowflake.style.animationDuration = Math.random() * 3 + 2 + 's'; 
            snowflake.style.opacity = Math.random();
            snowflake.style.width = snowflake.style.height = Math.random() * 10 + 5 + 'px';
            snowContainer.appendChild(snowflake);
        }
    }

    function getWeatherInfo(code) {
        if (code === 0) return { icon: 'â˜€ï¸', description: 'ë§‘ìŒ' };
        if (code >= 1 && code <= 3) return { icon: 'â˜ï¸', description: 'êµ¬ë¦„ ì¡°ê¸ˆ' };
        if (code >= 51 && code <= 99) return { icon: 'ğŸŒ§ï¸', description: 'ë¹„/ëˆˆ' };
        return { icon: 'ğŸ¤”', description: 'ì•Œ ìˆ˜ ì—†ìŒ' };
    }

    function updateClockDisplay(timeEl, dateEl, dayEl) {
        const now = new Date();
        timeEl.textContent = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
        const days = ['ì¼', 'ì›”', 'í™”', 'ìˆ˜', 'ëª©', 'ê¸ˆ', 'í† '];
        if (dayEl) {
             dateEl.textContent = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
             dayEl.textContent = `${days[now.getDay()]}ìš”ì¼`;
        } else {
             dateEl.textContent = `${now.getFullYear()}.${String(now.getMonth() + 1).padStart(2, '0')}.${String(now.getDate()).padStart(2, '0')}`;
        }
    }

    function calculateDday(targetDateStr) {
        const targetDate = new Date(targetDateStr);
        const today = new Date();
        targetDate.setHours(0, 0, 0, 0); today.setHours(0, 0, 0, 0);
        return Math.ceil((targetDate - today) / (1000 * 60 * 60 * 24));
    }
    
    async function renderPage(pageConfig) {
        if(clockInterval) clearInterval(clockInterval);
        if(pageTimeout) clearTimeout(pageTimeout);
        if (!pageConfig) return;

        if (pageConfig.snowEffect) {
            snowContainer.style.display = 'block';
            if (snowContainer.childElementCount === 0) createSnowflakes();
        } else {
            snowContainer.style.display = 'none';
        }

        let html = '';
        switch (pageConfig.type) {
            case 'celebration_page':
                html = `<div class="page celebration-page" style="background-image: url('${pageConfig.imageUrl}'), linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5));"><div class="msg-container"><h2>${pageConfig.subText}</h2></div></div>`;
                break;
            case 'info_page':
                infoPageDisplayCount++;
                const ddayItemsHTML = (pageConfig.ddayTargets || []).map(target => {
                    const ddayCount = calculateDday(target.date);
                    const ddayText = ddayCount > 0 ? `D-${ddayCount}` : (ddayCount === 0 ? 'D-Day!' : `D+${Math.abs(ddayCount)}`);
                    return `<div class="dday-item"><h2>${target.title}</h2><div class="dday-value">${ddayText}</div><div class="target-date">${target.date} ê¹Œì§€</div></div>`;
                }).join('');
                html = `<div class="page info-page"><div class="time-date-section"><div class="time-display"></div><div class="date-display"></div><div class="day-display"></div></div><div class="dday-section">${ddayItemsHTML}</div></div>`;
                break;
            case 'info_page_alt':
                 const altDdayItemsHTML = (pageConfig.ddayTargets || []).map(target => {
                    const ddayCount = calculateDday(target.date);
                    const ddayText = ddayCount > 0 ? `D-${ddayCount}` : (ddayCount === 0 ? 'D-Day!' : `D+${Math.abs(ddayCount)}`);
                    return `<div class="dday-item"><h2>${target.title}</h2><div class="dday-value">${ddayText}</div></div>`;
                }).join('');
                html = `<div class="page info-page-alt" style="background-image: url('${pageConfig.backgroundImage}')"><div class="time-display"></div><div class="date-display"></div><div class="dday-section">${altDdayItemsHTML}</div></div>`;
                break;
            case 'image_page':
                html = `<div class="page image-page"><img src="${pageConfig.imageUrl}" alt="í˜ì´ì§€ ì´ë¯¸ì§€" onerror="this.src='https://placehold.co/1920x1080/222/fff?text=No+Image';"></div>`;
                break;
            case 'youtube_page':
                html = `<div class="page youtube-page"><iframe src="https://www.youtube.com/embed/${pageConfig.videoId}?autoplay=1&mute=1&controls=0&loop=1&playlist=${pageConfig.videoId}&playsinline=1&rel=0" allow="autoplay; encrypted-media" allowfullscreen></iframe></div>`;
                break;
            case 'weather_page':
                // ë¡œë”© í™”ë©´ ë¨¼ì € í‘œì‹œ
                html = `<div class="page weather-page"><div class="current-weather"><div class="details"><div class="location">íŒêµ ì‚¼í‰ë™</div><div class="temp">--Â°</div><div class="desc">ë‚ ì”¨ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div></div></div></div>`;
                signageContainer.innerHTML = html;
                
                try {
                    const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=37.402&longitude=127.105&current=temperature_2m,weather_code&hourly=temperature_2m,weather_code&daily=temperature_2m_max,temperature_2m_min&timezone=Asia%2FSeoul`);
                    const data = await res.json();
                    
                    const cur = data.current;
                    const hourly = data.hourly;
                    const daily = data.daily;
                    const info = getWeatherInfo(cur.weather_code);

                    // ì‹œê°„ë³„ ì˜ˆë³´ ìƒì„± ë¡œì§ ë³µêµ¬
                    let forecastHtml = '';
                    const now = new Date();
                    const currentHour = now.getHours();
                    // í˜„ì¬ ì‹œê°„ ì´í›„ ë°ì´í„° ì°¾ê¸°
                    const startIndex = hourly.time.findIndex(t => new Date(t).getHours() > currentHour);
                    
                    // ë°ì´í„°ê°€ ìˆìœ¼ë©´ 6ì‹œê°„ ì˜ˆë³´ ìƒì„±
                    if (startIndex !== -1) {
                        for(let i = startIndex; i < startIndex + 6; i++) {
                            if (hourly.time[i]) {
                                const hourInfo = getWeatherInfo(hourly.weather_code[i]);
                                const date = new Date(hourly.time[i]);
                                const timeString = `${date.getHours()}ì‹œ`;
                                forecastHtml += `
                                    <div class="hour">
                                        <div class="time">${timeString}</div>
                                        <div class="icon">${hourInfo.icon}</div>
                                        <div class="temp">${Math.round(hourly.temperature_2m[i])}Â°</div>
                                    </div>
                                `;
                            }
                        }
                    }

                    // ìµœì¢… HTML ì¡°ë¦½
                    html = `
                        <div class="page weather-page">
                            <div class="current-weather">
                                <div class="icon">${info.icon}</div>
                                <div class="details">
                                    <div class="location">íŒêµ ì‚¼í‰ë™</div>
                                    <div class="temp">${Math.round(cur.temperature_2m)}Â°</div>
                                    <div class="desc">${info.description}</div>
                                    <div class="minmax">ìµœê³  ${Math.round(daily.temperature_2m_max[0])}Â° / ìµœì € ${Math.round(daily.temperature_2m_min[0])}Â°</div>
                                </div>
                            </div>
                            <div class="forecast">
                                ${forecastHtml}
                            </div>
                        </div>
                    `;
                } catch(e) {
                    console.error("ë‚ ì”¨ ë¡œë”© ì‹¤íŒ¨:", e);
                    html = `<div class="page weather-page"><div class="current-weather"><div class="details"><div class="desc">ë‚ ì”¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div></div></div></div>`;
                }
                break;
        }
        signageContainer.innerHTML = html;

        if (pageConfig.type.startsWith('info_page')) {
            const timeEl = document.querySelector('.time-display'), dateEl = document.querySelector('.date-display'), dayEl = document.querySelector('.day-display');
            updateClockDisplay(timeEl, dateEl, dayEl);
            clockInterval = setInterval(() => updateClockDisplay(timeEl, dateEl, dayEl), 1000);
            if (pageConfig.type === 'info_page' && pageConfig.backgroundImages && pageConfig.backgroundImages.length > 0) {
                const bgIndex = Math.floor((infoPageDisplayCount -1) / 3) % pageConfig.backgroundImages.length;
                document.querySelector('.info-page').style.backgroundImage = `url('${pageConfig.backgroundImages[bgIndex]}')`;
            }
        }
    }

    async function showNextPage() {
        let list = currentPlaylist;
        if (!list || list.length === 0) list = PLAYLIST;

        // [New] ì ì‹¬ì‹œê°„ ë¡œì§ ê°•í™” (11ì‹œ~12ì‹œ)
        function isLunchTime() {
            const now = new Date();
            const hour = now.getHours();
            return hour === 11; // 11ì‹œ 00ë¶„ ~ 11ì‹œ 59ë¶„
        }

        // ì ì‹¬ì‹œê°„ì´ë©´ ì‹ë‹¨í‘œ(ë˜ëŠ” íŠ¹ì • ì´ë¯¸ì§€) í˜ì´ì§€ë§Œ í•„í„°ë§í•´ì„œ ì¬ìƒ
        if (isLunchTime()) {
            const lunchPages = list.filter(p => p.imageUrl && p.imageUrl.includes('ì‹ë‹¨í‘œ'));
            // ë§Œì•½ ì‹ë‹¨í‘œ í˜ì´ì§€ê°€ í•˜ë‚˜ë¼ë„ ìˆë‹¤ë©´ ê·¸ê²ƒë“¤ë§Œ ì¬ìƒ
            if (lunchPages.length > 0) {
                list = lunchPages;
            }
        }
        
        if (currentPageIndex >= list.length) currentPageIndex = 0;
        const page = list[currentPageIndex];
        await renderPage(page);

        pageTimeout = setTimeout(() => {
            currentPageIndex = (currentPageIndex + 1) % list.length;
            showNextPage();
        }, page.duration * 1000);
    }

    document.addEventListener('DOMContentLoaded', () => {
        loadPlaylistData();
        showNextPage();
        // 1ì‹œê°„ë§ˆë‹¤ ìƒˆë¡œê³ ì¹¨ (ë©”ëª¨ë¦¬ ì •ë¦¬ìš©, í•„ìš”ì‹œ ì œê±° ê°€ëŠ¥)
        // setTimeout(() => window.location.reload(true), 3600000);
    });
    </script>
</body>
</html>




